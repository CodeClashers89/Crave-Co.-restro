<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crave & Co. - Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Raleway:wght@400;600&display=swap" rel="stylesheet">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Raleway', sans-serif;
    background: linear-gradient(135deg, #1a1a1a 0%, #030303 100%);
    color: white;
    min-height: 100vh;
}

.header {
    background: #030303;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(251,218,175,0.3);
}

.header h1 {
    font-family: 'Playfair Display', serif;
    color: rgb(251,218,175);
    text-align: center;
    font-size: 36px;
}

.stats-container {
    display: flex;
    gap: 20px;
    padding: 30px;
    flex-wrap: wrap;
    justify-content: center;
}

.stat-card {
    background: linear-gradient(135deg, #222 0%, #111 100%);
    padding: 25px;
    border-radius: 15px;
    min-width: 200px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(251,218,175,0.2);
    transition: transform 0.3s;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-card h3 {
    color: rgb(251,218,175);
    font-size: 18px;
    margin-bottom: 10px;
}

.stat-card .number {
    font-size: 48px;
    font-weight: bold;
    color: white;
}

.tabs {
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 20px;
    background: #111;
}

.tab-btn {
    background: #222;
    color: white;
    border: 2px solid rgb(251,218,175);
    padding: 12px 30px;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
}

.tab-btn:hover, .tab-btn.active {
    background: rgb(251,218,175);
    color: #030303;
}

.content {
    padding: 30px;
    max-width: 1400px;
    margin: 0 auto;
}

.section {
    display: none;
}

.section.active {
    display: block;
}

table {
    width: 100%;
    background: #111;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 20px rgba(251,218,175,0.2);
}

thead {
    background: rgb(251,218,175);
    color: #030303;
}

th, td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #333;
}

tbody tr {
    transition: background 0.3s;
}

tbody tr:hover {
    background: #1a1a1a;
}

.status-badge {
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    display: inline-block;
}

.status-pending {
    background: #ff9800;
    color: white;
}

.status-confirmed {
    background: #4caf50;
    color: white;
}

.status-preparing {
    background: #2196f3;
    color: white;
}

.status-delivered {
    background: #9c27b0;
    color: white;
}

.status-cancelled {
    background: #f44336;
    color: white;
}

.action-btn {
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    margin: 2px;
    transition: all 0.3s;
}

.btn-preparing {
    background: #2196f3;
    color: white;
}

.btn-delivered {
    background: #9c27b0;
    color: white;
}

.btn-cancel {
    background: #f44336;
    color: white;
}

.action-btn:hover {
    opacity: 0.8;
    transform: scale(1.05);
}

.order-items {
    font-size: 13px;
    color: #ccc;
    max-width: 300px;
}

.refresh-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: rgb(251,218,175);
    color: #030303;
    border: none;
    padding: 15px 25px;
    border-radius: 50px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 5px 15px rgba(251,218,175,0.4);
    transition: all 0.3s;
}

.refresh-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 20px rgba(251,218,175,0.6);
}

.empty-state {
    text-align: center;
    padding: 60px;
    color: #999;
    font-size: 18px;
}

@media (max-width: 768px) {
    table {
        font-size: 12px;
    }
    
    th, td {
        padding: 10px 5px;
    }
    
    .action-btn {
        padding: 6px 10px;
        font-size: 11px;
    }
}
</style>
</head>
<body>

<div class="header">
    <h1>üçΩÔ∏è Crave & Co. Admin Dashboard</h1>
</div>

<div class="stats-container">
    <div class="stat-card">
        <h3>Total Orders</h3>
        <div class="number" id="totalOrders">0</div>
    </div>
    <div class="stat-card">
        <h3>Pending Orders</h3>
        <div class="number" id="pendingOrders">0</div>
    </div>
    <div class="stat-card">
        <h3>Total Bookings</h3>
        <div class="number" id="totalBookings">0</div>
    </div>
    <div class="stat-card">
        <h3>Today's Bookings</h3>
        <div class="number" id="todayBookings">0</div>
    </div>
</div>

<div class="tabs">
    <button class="tab-btn active" onclick="showTab('orders')">üì¶ Orders</button>
    <button class="tab-btn" onclick="showTab('bookings')">ü™ë Table Bookings</button>
    <button class="tab-btn" onclick="showTab('contacts')">üìß Contact Messages</button>
</div>

<div class="content">
    <!-- Orders Section -->
    <div id="orders" class="section active">
        <h2 style="color: rgb(251,218,175); margin-bottom: 20px;">Recent Orders</h2>
        <div id="ordersTable"></div>
    </div>

    <!-- Bookings Section -->
    <div id="bookings" class="section">
        <h2 style="color: rgb(251,218,175); margin-bottom: 20px;">Table Bookings</h2>
        <div id="bookingsTable"></div>
    </div>

    <!-- Contacts Section -->
    <div id="contacts" class="section">
        <h2 style="color: rgb(251,218,175); margin-bottom: 20px;">Contact Messages</h2>
        <div id="contactsTable"></div>
    </div>
</div>

<button class="refresh-btn" onclick="loadAllData()">üîÑ Refresh</button>

<script>
let ordersData = [];
let bookingsData = [];
let contactsData = [];

async function loadAllData() {
    await loadOrders();
    await loadBookings();
    await loadContacts();
    updateStats();
}

async function loadOrders() {
    try {
        const response = await fetch('/admin/orders');
        ordersData = await response.json();
        renderOrders();
    } catch (error) {
        console.error('Error loading orders:', error);
    }
}

async function loadBookings() {
    try {
        const response = await fetch('/admin/bookings');
        bookingsData = await response.json();
        renderBookings();
    } catch (error) {
        console.error('Error loading bookings:', error);
    }
}

async function loadContacts() {
    try {
        const response = await fetch('/admin/contacts');
        contactsData = await response.json();
        renderContacts();
    } catch (error) {
        console.error('Error loading contacts:', error);
    }
}

function renderOrders() {
    const container = document.getElementById('ordersTable');
    
    if (ordersData.length === 0) {
        container.innerHTML = '<div class="empty-state">No orders yet</div>';
        return;
    }
    
    let html = `
        <table>
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Phone</th>
                    <th>Items</th>
                    <th>Total</th>
                    <th>Address</th>
                    <th>Time</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    ordersData.reverse().forEach(order => {
        const itemsList = order.cart.map(item => `${item.item} (${item.qty})`).join(', ');
        html += `
            <tr>
                <td>#${order.id}</td>
                <td>${order.name}</td>
                <td>${order.phone}</td>
                <td class="order-items">${itemsList}</td>
                <td>‚Çπ${order.grandTotal}</td>
                <td>${order.address}</td>
                <td>${order.timestamp}</td>
                <td><span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span></td>
                <td>
                    ${order.status === 'Pending' ? `
                        <button class="action-btn btn-preparing" onclick="updateOrderStatus(${order.id}, 'Preparing')">Preparing</button>
                        <button class="action-btn btn-cancel" onclick="updateOrderStatus(${order.id}, 'Cancelled')">Cancel</button>
                    ` : ''}
                    ${order.status === 'Preparing' ? `
                        <button class="action-btn btn-delivered" onclick="updateOrderStatus(${order.id}, 'Delivered')">Delivered</button>
                    ` : ''}
                </td>
            </tr>
        `;
    });
    
    html += '</tbody></table>';
    container.innerHTML = html;
}

function renderBookings() {
    const container = document.getElementById('bookingsTable');
    
    if (bookingsData.length === 0) {
        container.innerHTML = '<div class="empty-state">No bookings yet</div>';
        return;
    }
    
    let html = `
        <table>
            <thead>
                <tr>
                    <th>Booking ID</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Guests</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Special Requests</th>
                    <th>Booked At</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    bookingsData.reverse().forEach(booking => {
        html += `
            <tr>
                <td>#${booking.id}</td>
                <td>${booking.name}</td>
                <td>${booking.phone}</td>
                <td>${booking.people} people</td>
                <td>${booking.date}</td>
                <td>${booking.time}</td>
                <td>${booking.requests || 'None'}</td>
                <td>${booking.timestamp}</td>
                <td><span class="status-badge status-${booking.status.toLowerCase()}">${booking.status}</span></td>
                <td>
                    ${booking.status === 'Confirmed' ? `
                        <button class="action-btn btn-cancel" onclick="updateBookingStatus(${booking.id}, 'Cancelled')">Cancel</button>
                    ` : ''}
                </td>
            </tr>
        `;
    });
    
    html += '</tbody></table>';
    container.innerHTML = html;
}

function renderContacts() {
    const container = document.getElementById('contactsTable');
    
    if (contactsData.length === 0) {
        container.innerHTML = '<div class="empty-state">No messages yet</div>';
        return;
    }
    
    let html = `
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Message</th>
                    <th>Received At</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    contactsData.reverse().forEach(contact => {
        html += `
            <tr>
                <td>#${contact.id}</td>
                <td>${contact.name}</td>
                <td>${contact.email}</td>
                <td>${contact.phone}</td>
                <td>${contact.message}</td>
                <td>${contact.timestamp}</td>
            </tr>
        `;
    });
    
    html += '</tbody></table>';
    container.innerHTML = html;
}

async function updateOrderStatus(orderId, newStatus) {
    try {
        const response = await fetch('/admin/update-order-status', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id: orderId, status: newStatus})
        });
        
        if (response.ok) {
            await loadOrders();
            updateStats();
        }
    } catch (error) {
        console.error('Error updating order:', error);
    }
}

async function updateBookingStatus(bookingId, newStatus) {
    try {
        const response = await fetch('/admin/update-booking-status', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id: bookingId, status: newStatus})
        });
        
        if (response.ok) {
            await loadBookings();
            updateStats();
        }
    } catch (error) {
        console.error('Error updating booking:', error);
    }
}

function updateStats() {
    document.getElementById('totalOrders').textContent = ordersData.length;
    
    const pending = ordersData.filter(o => o.status === 'Pending').length;
    document.getElementById('pendingOrders').textContent = pending;
    
    document.getElementById('totalBookings').textContent = bookingsData.length;
    
    const today = new Date().toISOString().split('T')[0];
    const todayBookings = bookingsData.filter(b => b.date === today).length;
    document.getElementById('todayBookings').textContent = todayBookings;
}

function showTab(tabName) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');
}

// Auto refresh every 30 seconds
setInterval(loadAllData, 30000);

// Initial load
loadAllData();
</script>

</body>
</html>